<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.victor.h5blog.dao.UserDao">

	<resultMap id="resultUserList" type="User">
		<id column="USER_ID" property="userId" />
		<result column="LOGIN_NAME" property="loginName" />
		<result column="LOGIN_PWD" property="loginPwd" />
		<result column="USER_FLAG" property="userFlag" />
		<result column="REAL_NAME" property="realName" />
		<result column="USER_EMAIL" property="userEmail" />
		<result column="USER_PHONE" property="userPhone" />
		<result column="USER_MOBILE" property="userMobile" />
		<result column="USER_SEX" property="userSex" />
		<result column="COMPANY_NAME" property="companyName" />
		<result column="DEPARTMENT_NAME" property="departmentName" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="LAST_MODIFY_TIME" property="lastModifyTime" />
		<result column="USER_STATE" property="userState" />
		<result column="DELETE_FLAG" property="deleteFlag" />
		<result column="IS_FIRST_LOG" property="isFirstLog" />
		<result column="LOGIN_ERROR_NUM" property="loginErrorNum" />
		<result column="MEMO" property="memo" />
	</resultMap>
	<!-- 获取所有用户列表 -->
	<select id="findAllList" resultType="User" resultMap="resultUserList">
		SELECT *
		FROM LEGOO_USER WHERE DELETE_FLAG != "1"
		LIMIT
		#{offset},#{rows}
	</select>
	<!-- 获取所有用户数量 -->
	<select id="findAllListCount" resultType="int">
		SELECT COUNT(*) FROM
		LEGOO_USER WHERE DELETE_FLAG != "1"
	</select>
	<!-- 获取后台的用户数量 -->
	<select id="findNormalCount" resultType="int">
		SELECT COUNT(*) FROM
		LEGOO_USER WHERE DELETE_FLAG != "1" AND USER_STATE = "1" AND
		USER_FLAG="0"
	</select>
	<!-- 根据ID获取用户 -->
	<select id="findUserById" resultType="User" resultMap="resultUserList">
		SELECT *
		FROM LEGOO_USER
		WHERE
		USER_ID = #{userId}
	</select>
	<!-- 根据登录名获取后台用户, shiro权限用 -->
	<select id="findUserByName" resultType="User" resultMap="resultUserList">
		SELECT *
		FROM LEGOO_USER
		WHERE
		LOGIN_NAME = #{loginName} AND USER_FLAG="0"
	</select>
	<!-- 修改用户信息 -->
	<update id="updateUserById" parameterType="User">
		UPDATE LEGOO_USER
		<set>
			<if test="loginName != null">
				LOGIN_NAME=#{loginName},
			</if>
			<if test="loginPwd != null">
				LOGIN_PWD=#{loginPwd},
			</if>
			<if test="userFlag != null">
				USER_FLAG=#{userFlag},
			</if>
			<if test="realName != null">
				REAL_NAME=#{realName},
			</if>
			<if test="userEmail != null">
				USER_EMAIL=#{userEmail},
			</if>
			<if test="userPhone != null">
				USER_PHONE=#{userPhone},
			</if>
			<if test="userMobile != null">
				USER_MOBILE=#{userMobile},
			</if>
			<if test="userSex != null">
				USER_SEX=#{userSex},
			</if>
			<if test="companyName != null and companyName!=''">
				COMPANY_NAME=#{companyName},
			</if>
			<if test="departmentName != null">
				DEPARTMENT_NAME=#{departmentName},
			</if>
			<if test="createTime != null">
				CREATE_TIME=#{createTime},
			</if>
			<if test="lastModifyTime != null">
				LAST_MODIFY_TIME=#{lastModifyTime},
			</if>
			<if test="userState != null">
				USER_STATE=#{userState},
			</if>
			<if test="deleteFlag != null">
				DELETE_FLAG =#{deleteFlag},
			</if>
			<if test="isFirstLog != null">
				IS_FIRST_LOG =#{isFirstLog},
			</if>
			<if test="loginErrorNum != null">
				LOGIN_ERROR_NUM =#{loginErrorNum},
			</if>
			<if test="memo != null">
				MEMO=#{memo},
			</if>
		</set>
		WHERE
		USER_ID=#{userId}
	</update>
	<!-- 根据ID删除用户 -->
	<update id="deleteUserById">
		UPDATE LEGOO_USER SET DELETE_FLAG = "1" WHERE USER_ID
		= #{userId}
	</update>
	<!-- 新增用户 -->
	<insert id="addUser" parameterType="User" useGeneratedKeys="true"
		keyProperty="userId">
		insert into LEGOO_USER
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<!-- USER_ID, -->
			<if test="loginName != null">
				LOGIN_NAME,
			</if>
			<if test="loginPwd != null">
				LOGIN_PWD,
			</if>
			<if test="userFlag != null">
				USER_FLAG,
			</if>
			<if test="realName != null">
				REAL_NAME,
			</if>
			<if test="userEmail != null">
				USER_EMAIL,
			</if>
			<if test="userPhone != null">
				USER_PHONE,
			</if>
			<if test="userMobile != null">
				USER_MOBILE,
			</if>
			<if test="userSex != null">
				USER_SEX,
			</if>
			<if test="companyName != null and companyName!=''">
				COMPANY_NAME,
			</if>
			<if test="departmentName != null">
				DEPARTMENT_NAME,
			</if>
			<if test="createTime != null">
				CREATE_TIME,
			</if>
			<if test="lastModifyTime != null">
				LAST_MODIFY_TIME,
			</if>
			<if test="userState != null">
				USER_STATE,
			</if>
			<if test="deleteFlag != null">
				DELETE_FLAG,
			</if>
			<if test="isFirstLog != null">
				IS_FIRST_LOG,
			</if>
			<if test="loginErrorNum != null">
				LOGIN_ERROR_NUM,
			</if>
			<if test="memo != null">
				MEMO,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<!-- <choose> -->
			<!-- <when test="userId !=null">#{userId},</when> -->
			<!-- <when test="userId ==null">UUID_SHORT(),</when> -->
			<!-- </choose> -->
			<if test="loginName != null">
				#{loginName},
			</if>
			<if test="loginPwd != null">
				#{loginPwd},
			</if>
			<if test="userFlag != null">
				#{userFlag},
			</if>
			<if test="realName != null">
				#{realName},
			</if>
			<if test="userEmail != null">
				#{userEmail},
			</if>
			<if test="userPhone != null">
				#{userPhone},
			</if>
			<if test="userMobile != null">
				#{userMobile},
			</if>
			<if test="userSex != null">
				#{userSex},
			</if>
			<if test="companyName != null and companyName!=''">
				#{companyName},
			</if>
			<if test="departmentName != null">
				#{departmentName},
			</if>
			<if test="createTime != null">
				#{createTime},
			</if>
			<if test="lastModifyTime != null">
				#{lastModifyTime},
			</if>
			<if test="userState != null">
				#{userState},
			</if>
			<if test="deleteFlag != null">
				#{deleteFlag},
			</if>
			<if test="isFirstLog != null">
				#{isFirstLog},
			</if>
			<if test="loginErrorNum != null">
				#{loginErrorNum},
			</if>
			<if test="memo != null">
				#{memo},
			</if>
		</trim>
		<selectKey resultType="java.lang.Long" order="AFTER"
			keyProperty="userId">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

</mapper>  
